![[Pasted image 20220102051426.png]]


图8-11中，主线程只管理监听socket，连接socket由工作线程来管理。

当有新的连接到来时，主线程就接受之并将新返回的连接socket派发给某个工作线程，此后该新socket上的任何I/O操作都由被选中的工作线程来处理，直到客户关闭连接。

主线程向工作线程派发socket的最简单的方式，是往它和工作线程之间的[[管道]]里写数据。工作线程检测到管道上有数据可读时，就分析是否是一个新的客户连接请求到来。
如果是，则把该新socket上的读写事件注册到自己的epoll内核事件表中。

可见，图8-11中，每个线程（主线程和工作线程）都维持自己的事件循环，它们各自独立地监听不同的事件。

因此，在这种高效的半同步/半异步模式中，每个线程都工作在异步模式，所以它并非严格意义上的半同步/半异步模式。

我们将在第15章给出一个用这种高效的半同步/半异步模式实现的简单CGI服务器的代码。