[[阻抗匹配原则]]

如果池中线程在执行任务时，密集计算所占的时间比重为P（0＜P≤1），而系统一共有C个CPU，为了让这C个CPU跑满而又不过载，线程池大小的经验公式T＝C/P。T是个hint，考虑到P值的估计不是很准确，T的最佳值可以上下浮动50％.这个经验公式的原理很简单，T个线程，每个线程占用P的CPU时间，如果刚好占满C个CPU，那么必有T×P＝C。下面验证一下边界条件的正确性。

假设C＝8，P＝1.0，线程池的任务完全是密集计算，那么T＝8。只要8个活动线程就能让8个CPU饱和，再多也没用，因为CPU资源已经耗光了。

假设C＝8，P＝0.5，线程池的任务有一半是计算，有一半等在IO上，那么T＝16。考虑操作系统能灵活、合理地调度sleeping/writing/running线程，那么大概16个“50％繁忙的线程”能让8个CPU忙个不停。**启动更多的线程并不能提高吞吐量，反而因为增加上下文切换的开销而降低性能。**

如果P＜0.2，这个公式就不适用了，T可以取一个固定值，比如5×C。另外，公式里的C不一定是CPU总数，可以是“分配给这项任务的CPU数目”，比如在8核机器上分出4个核来做一项任务，那么C＝4。