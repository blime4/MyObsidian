本文参考《分布式系统常用技术及案例分析》和《分布式实时处理系统 原理、架构和实现》

《分布式系统原理与范型》一书中是这样定义分布式系统的：“分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统”。

这里面包含了2个含义:

* 硬件独立
* 软件统一

什么是硬件独立？所谓硬件独立，是指计算机机器本身是独立的。一个大型的分布式系统，会由若干台计算机来组成系统的基础设施。而软件统一，是指对于用户来说，用户就像是跟单个系统打交道。就好比我们每天上网看视频，视频网站对我们来说就是一个系统软件，它们背后是如何运作的，部署了几台服务器，每台服务器是干什么的，这些对用户来说是透不可见的。用户不关心背后的这些服务器，用户所关心的是今天访问的这个网站能提供什么样的节目，视频运行是否流畅，卡不卡帧、清晰度如何等。

而软件统一的另外一个方面是指，分布式系统的扩展和升级都比较容易。分布式系统中的某些节点发生故障也不会影响整体系统的可用性。用户和应用程序交互时不会察觉哪些部分正在替换或者维修，也不会感知到新加入的部分。


### 一、分布式概念

由计算机组成的网络无处不在，现如今我们的日常生活已经被各种不同类型的网络包围，如电话网络、企业网络、家庭网络以及各种类型的局域网，共同构成了我们称之为Internet的网络。因此，我们可以断言Internet是由各种不同类型、不同地区、不同领域的网络构成的互联网。我们可以发现，互联网并没有集中式的控制中心，而是由大量分离且互联 的节点组成的。这正是一个分散式的模型。我们可以把这个概念类比到即将讲解的分布式概念上。

分布式概念是在网络这个大前提下诞生的。传统的计算是集中式的计算，使用计算能力强大的服务器处理大量的计算任务，但这种超级计算机的建造和维护成本极高，且明显存在很大的瓶颈。与之相对，如果一套系统可以将需要海量计算能力才能处理的问题拆分成许多小块，然后将这些小块分配给同一套系统中不同的计算节点进行处理，最后如有必要将分开计算的结果合并得到最终结果，那么就将这种系统称为分布式系统。对于这种系统来说，我们会采用多种方式在不同节点之间进行数据通信和协调，而网络消息则是常用手段之一。

通过以上描述，我们基本可以认为，一套分布式系统会使用网络上的硬件资源和软件组件进行计算，而各个计算节点间通过一定方式进行通信。这是从计算机科学的角度简单概述了分布式系统的概念。

如果我们从网络这个关键因素考虑，我们可以将计算分摊到网络中不同的计算节点，充分利用网络中的计算资源，而这些节点可能存在于不同的区域中，在空间上存在一定距离。虽说这种解释不那么正式，但也从另一个角度上生动地阐述了分布式的基本特性，即节点分布。


### 二、集中式系统与分布式系统
集中式系统
优点是便于维护，操作简单。但这样的系统也有缺陷，就是不出问题还好，一出问题，就会造成单点故障，所有功能就都不能正常工作了。
![[Pasted image 20211230172344.png]]

分布式系统
是通过中间软件来对现有计算机的硬件能力和相应的软件功能进行重新配置和整合。它是一种多处理器的计算机系统，各处理器通过互连网络构成统一的系统。系统采用分布式计算结构，即把原来系统内中央处理器处理的任务分散给相应的处理器，实现不同功能的各个处理器相互协调，共享系统的外设与软件。这样就加快了系统的处理速度，简化了主机的逻辑结构。它甚至不需要很高的配置，一些低配置“退休”下来的机器也能被重新纳入分布式系统中使用，这样无疑就降低了成本，而且还易于维护。

![[Pasted image 20211230172402.png]]

### 三、分布式计算及其原理

分布式计算就是将计算任务分摊到大量的计算节点上，一起完成海量的计算任务。

而分布式计算的原理和并行计算类似，就是将一个复杂庞大的计算任务适当划分为一个一个小任务，并让任务并行执行，只不过分布式计算会将这些任务分配到不同的计算节点上，每个计算节点只需要完成自己的计算任务即可，可以有效分担海量的计算任务。而每个计算节点也可以并行处理自身的任务，更加充分利用机器的CPU资源。最后我们想方设法将每个节点计算结果汇总，得到最后的计算结果。

分布式计算一般分为以下几步：

1）**设计分布式计算模型**：首先我们要规定分布式系统的计算模型。计算模型决定了系统中各个组件应该如何运行，组件之间应该如何进行消息通信，组件和节点应该如何管理等。

2）**分布式任务分配**：分布式算法不同于普通算法。普通算法通常是按部就班，一步接着一步完成任务。而分布式计算中计算任务是分摊到各个节点上的。该算法着重解决的是能否分配任务，或如何分配任务的问题。

3）**编写并执行分布式程序**：使用特定的分布式计算框架与计算模型，将分布式算法转化为实现，并尽量保证整个集群的高效运行。其中有一些难点。
-   ①计算任务的划分
    
    分布式计算的特点就是多个节点同时运算，因此如何将复杂算法优化分解成适用于每个节点计算的小任务，并回收节点的计算结果就成了问题。尤其是并行计算的最大特点是希望节点之间的计算互不相干，这样可以保证各节点以最快速度完成计算，一旦出现节点之间的等待，往往就会拖慢整个系统的速度。
    
-   ②多节点之间的通信方式
    
    另一个难点是节点之间如何高效通信。虽然在划分计算任务时，计算任务最好确保互不相干，这样每个节点可以各自为政。但大多数时候节点之间还是需要互相通信，比如获取对方的计算结果等。
	一般有两种解决方案：
	一种是利用[[消息队列]]，将节点之间的依赖变成节点之间的消息传递；
	第二种是利用[[分布式存储系统]]，我们可以将节点的执行结果暂时存放在数据库中，其他节点等待或从数据库中获取数据。无论哪种方式只要符合实际需求都是可行的。


### 四、分布式系统特性
#### 1、容错性
> 1. 需要具备检测、恢复和避免故障的能力(网络延迟、消息乱序)
> 2. 故障恢复(回滚永久数据的状态, 事务性)
> 3. 消息重发、冗余等
	> 1. 在一定超时范围内，消息不可达时对消息进行重传，在重新尝试多次后如果消息仍然不可达，才认为节点出现问题。
	> 2. 数据冗余存储可以在一定程度上降低数据出错的概率。
> 4. 冗余是设计分布式系统时必须考虑的特性之一，也是系统对外提供服务的质量的重要保证，提高用户体验，尽可能减少服务不可用时间是非常重要的。
#### 2、高可扩展性
例子：Storm实时处理系统（以下简称Storm）
> 在Storm中，节点主要由Spout和Bolt两大类组成，我们可以把这种关系类比到MapReduce过程，Spout作为消息源会将搜集到的数据发送到Storm计算拓扑中，再通过一系列消息处理单元Bolt进行分布式处理，最终将处理结果合并得到最终结果。在这里，消息处理单元Bolt是分布式数据处理的核心组件，每当消息处理单元的数据处理完成后，它就会把当前阶段处理的数据发送给下一级消息处理单元做进一步处理。那么，这些消息处理单元之间的元组数据则主要通过开源JSON格式进行传递。利用这种机制，我们看到了一个很好的现象，那就是我们可以随意在消息处理单元后进行扩充，如果数据处理的结果还达不到我们的需求，只需在Storm计算拓扑中继续追加新的消息处理单元，直至满足我们的需求。Storm使用JSON作为节点之间元组数据发送的纽带，一方面解决了私有接口难以扩展和集成的问题，另一方面解决了Storm拓扑结构的后续节点扩充问题。下图所示为基本的Storm实时处理系统拓扑结构图，其中每个方框都是一个节点。
![[Pasted image 20211230173334.png]]
#### 3、开放性
对外提供开放应用程序编程接口（Open API）
#### 4、并发处理能力
1）Consistency（一致性）：同一个数据在集群中的所有节点，同一时刻 是否都是同样的值。
2）Availability（可用性）：集群中一部分节点故障后，集群整体是否还 能处理客户端的更新请求。
3）Partition Tolerance（分区容错性）：是否允许数据的分区，分区是指 是否允许集群中的节点之间无法通信。
> 在理论计算机科学中，CAP定理（CAP Theorem）又被称作布鲁尔定理（Brewer’s Theorem），它指出对于一个分布式计算系统来说，不可能同时满足CAP 3个条件。
> 而由于当前的网络硬件肯定会出现延迟丢包等问题，所以**分区容忍性是我们必须要实现的**。所以我们只能在一致性和可用性之间进行权衡，没有NoSQL系统能同时满足这三点。

#### 5、透明性
在分布式系统内部，可能有成千上万个节点在同时工作，对用户的一个请求进行处理，最终得出结果。虽说如此，但我们设计的系统内部细节应该对用户保持一定程度的透明，我们可以为用户提供资源定位符（URL）来访问分布式系统服务，但用户对分布式系统内部的组件是无从了解的。我们应该把分布式系统当做一个整体来看待，而不是多个微型服务节点构成的集合。


### 五、[[CAP 理论]]

