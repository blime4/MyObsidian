# 001 - select 的原理以及缺点

[[select]]
[[select、poll和epoll对比]]

链接：[https://www.nowcoder.com/questionTerminal/c1cc7ade59ea458983c8f747c803c848](https://www.nowcoder.com/questionTerminal/c1cc7ade59ea458983c8f747c803c848)  
来源：牛客网  

select 是 一种 IO 多路复用技术，它的主旨思想是：

1.  首先要构造一个关于文件描述符的列表，将要监听的文件描述符添加到该列表中，这个文件描述符的列表数据类型为 fd_set，它是一个整型数组，总共是 1024 个比特位，每一个比特位代表一个文件描述符的状态。比如当需要 select 检测时，这一位为 0 就表示不检测对应的文件描述符的事件，为 1 表示检测对应的文件描述符的事件。
    
2.  调用 select() 系统调用，监听该列表中的文件描述符的事件，这个函数是阻塞的，直到这些描述符中的一个或者多个进行 I/O 操作时，该函数才返回，并修改文件描述符的列表中对应的值，0 表示没有检测到该事件，1 表示检测到该事件。函数对文件描述符的检测的操作是由内核完成的。
    
3.  select() 返回时，会告诉进程有多少描述符要进行 I/O 操作，接下来遍历文件描述符的列表进行 I/O 操作。
    

select 的缺点：

1.  每次调用select，都需要把 fd 集合从用户态拷贝到内核态，这个开销在 fd 很多时会很大；
2.  同时每次调用 select 都需要在内核遍历传递进来的所有 fd，这个开销在 fd 很多时也很大；
3.  select 支持的文件描述符数量太小了，默认是 1024（由 fd_set 决定）；
4.  文件描述符集合不能重用，因为内核每次检测到事件都会修改，所以每次都需要重置；
5.  每次 select 返回后，只能知道有几个 fd 发生了事件，但是具体哪几个还需要遍历文件描述符集合进一步判断。