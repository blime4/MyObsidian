---
doc_type: weread-highlights-reviews
bookId: "43770317"
author: 李伟
cover: https://cdn.weread.qq.com/weread/cover/0/YueWen_43770317/t7_YueWen_43770317.jpg
reviewCount: 1
noteCount: 31
readingStatus: 在读
progress: 17%
totalReadDay: 12
readingTime: 4小时51分钟
readingDate: 2023-04-26
isbn: 9787115570123
lastReadDate: 2023-05-18

---
# 元数据
> [!abstract] 动手打造深度学习框架
> - ![ 动手打造深度学习框架|200](https://cdn.weread.qq.com/weread/cover/0/YueWen_43770317/t7_YueWen_43770317.jpg)
> - 书名： 动手打造深度学习框架
> - 作者： 李伟
> - 简介： 本书基于C++编写，旨在带领读者动手打造出一个深度学习框架。本书首先介绍C++模板元编程的基础技术，然后在此基础上剖析深度学习框架的内部结构，逐一实现深度学习框架中的各个组件和功能，包括基本数据结构、运算与表达模板、基本层、复合层、循环层、求值与优化等，最终打造出一个深度学习框架。本书将深度学习框架与C++模板元编程有机结合，更利于读者学习和掌握使用C++开发大型项目的方法。本书适合对C++有一定了解，希望深入了解深度学习框架内部实现细节，以及提升C++程序设计水平的读者阅读。
> - 出版时间 2022-04-01 00:00:00
> - ISBN： 9787115570123
> - 分类： 计算机-编程设计
> - 出版社： 人民邮电出版社
> - PC地址：https://weread.qq.com/web/reader/08932070729be1cd0892272

# 高亮划线

## 前言

> 📌 本章将会讨论自动梯度计算的一种实现方式，它也是本书的重点之一。 
> ⏱ 2023-05-01 16:44:44 ^43770317-5-10278-10309

> 📌 循环层的特殊之处在于需要对输入数据进行拆分，对拆分后的数据依次执行正向、反向传播逻辑，并将执行后的结果进行合并。 
> ⏱ 2023-05-01 16:47:05 ^43770317-5-10358-10414

> 📌 提升计算速度 
> ⏱ 2023-05-01 16:45:22 ^43770317-5-10561-10567

> 📌 从数学意义上简化与合并多个计算过程 
> ⏱ 2023-05-01 16:45:40 ^43770317-5-10624-10641

#### 1.2 模板型模板参数与容器模板

> 📌 这几乎可以称为元编程中的一个惯用法——仅在必要的时候才引入定义，其他时候直接使用声明即可。 
> ⏱ 2023-05-08 12:59:02 ^43770317-9-6091-6136

#### 1.4 顺序、分支与循环代码的编写

> 📌 鉴于上述原因，conditional与conditional_t的使用场景是相对较少的。除非是特别简单的分支情况，否则并不建议使用这两个元函数。 
> ⏱ 2023-05-09 16:21:34 ^43770317-11-7706-7778

> 📌 事实上，通过元函数在编译期选择正确的运行期函数是一种相对常见的编程方法，为此C++17专门引入了一种新的语句if constexpr来简化代码的编写。 
> ⏱ 2023-05-16 21:56:31 ^43770317-11-15213-15288

> 📌 其次，if constexpr只能放在一般意义上的函数内部，用于在编译期选择所执行的代码。如果我们希望构造元函数，通过分支来返回不同的类型作为结果，那么if constexpr就无能为力了。具体在什么情况下使用if constexpr，还需要针对特定的问题具体分析。 
> ⏱ 2023-05-16 22:00:14 ^43770317-11-16802-16935

> 📌 一般来说，我们不会用while、for这样的语句组织元函数中的循环代码——因为这些代码操作的是变量。但在编译期，我们操作的更多的则是常量、类型与模板[13]。为了能够有效地操作元数据，我们往往会使用递归的形式来实现循环。 
> ⏱ 2023-05-16 22:00:55 ^43770317-11-17005-17207

> 📌 一般来说，在采用递归实现循环的元程序中，需要引入一个分支来结束循环。 
> ⏱ 2023-05-16 22:04:04 ^43770317-11-17895-17929

> 📌 使用递归来编写循环是一种通用的解决方案。除此之外，对于一些特殊的循环需求，C++ 也提供了更简单的解决方案：折叠表达式与包展开。 
> ⏱ 2023-05-16 22:09:14 ^43770317-11-18927-18991

> 📌 常见的折叠应用包含求和、求最大最小值等。 
> ⏱ 2023-05-16 22:09:52 ^43770317-11-19181-19201

> 📌 事实上，折叠表达式不仅可以用于编译期计算，也可以用于运行期计算： 
> ⏱ 2023-05-16 22:11:32 ^43770317-11-19586-19618

> 📌 当然，由于fun函数调用了运行期逻辑，因此它也就不再是一个元函数了，因为不能在其声明中引入constexpr限定符。 
> ⏱ 2023-05-16 22:12:48 ^43770317-11-20201-20259

> 📌 可以使用折叠表达式依次输出数值序列中的元素，即使元素的类别不同也没有关系： 
> ⏱ 2023-05-16 22:13:40 ^43770317-11-20329-20366

> 📌 折叠表达式通常用于操作数值，它只能返回单个数值 
> ⏱ 2023-05-16 22:15:53 ^43770317-11-21229-21252

> 📌 折叠表达式通常来说要放到函数体中，这也在一定程度上限制了它的使用范围。 
> ⏱ 2023-05-16 22:16:01 ^43770317-11-21405-21474

> 📌 从某种角度来说，折叠表达式只是一种语法糖，用于简化特定情形下的循环书写而已。 
> ⏱ 2023-05-16 22:16:05 ^43770317-11-21474-21512

> 📌 包展开返回的是一个序列，而折叠表达式通常返回的是数值； 
> ⏱ 2023-05-16 22:18:58 ^43770317-11-22207-22235

> 📌 包展开返回的可以是类型（这里就是一个可变长度数组类型），而折叠表达式通常返回一个数值； 
> ⏱ 2023-05-16 22:19:09 ^43770317-11-22251-22295

> 📌 我们也不难发现包展开的一些局限性。它只能满足某些特殊的循环需求：要求输入与输出均是数组，输入数组中的每个元素与输出数组中的元素存在一一映射的关系。映射可以是类型间的，也可以是类型与数值间的，由元函数来表示。 
> ⏱ 2023-05-16 22:24:46 ^43770317-11-23940-24043

> 📌 第1～2行是CompileTimeSwitch_的声明，它表明这个模板接收两个类型作为模板参数。这两个类型实际上对应了bool类型与结果数组。 
> ⏱ 2023-05-16 22:42:41 ^43770317-11-27261-27332

> 📌 第20～24行则包含了循环的结束逻辑：如果在之前的判断中，没有任何一个bool值为true，同时存在默认分支，那么直接返回默认分支。 
> ⏱ 2023-05-16 22:45:05 ^43770317-11-27545-27611

> 📌 CompileTimeSwitch会作为一个辅助元函数用于深度学习框架的打造。 
> ⏱ 2023-05-16 22:47:34 ^43770317-11-27997-28036

> 📌 但即使选择后一种方式，我们也应当尽力避免名字污染。为了解决这个问题，在后续打造深度学习框架时，我们会引入专用的名字空间，来存放像imp这样的辅助代码。 
> ⏱ 2023-05-16 22:52:17 ^43770317-11-31996-32071

> 📌 减少编译期实例化的另一种重要的技术就是引入短路逻辑。 
> ⏱ 2023-05-16 22:52:43 ^43770317-11-32143-32169

#### 1.5 奇特的递归模板式

> 📌 CRTP是一种派生类的声明方式，其“奇特”之处就在于：派生类会将本身作为模板参数传递给其基类 
> ⏱ 2023-05-16 22:58:30 ^43770317-12-652-698

> 📌 CRTP有很多应用场景，模拟虚函数是其典型应用之一。 
> ⏱ 2023-05-16 23:00:48 ^43770317-12-1085-1111

> 📌 除了函数模板外，类的静态成员函数也无法被声明为虚函数。此时借用CRTP，同样能达到类似虚函数的效果： 
> ⏱ 2023-05-16 23:09:52 ^43770317-12-2333-2383

> 📌 元编程涉及的函数大部分与模板相关，或者往往是类中的静态成员函数。在这种情况下，如果要实现类似运行期的多态特性，就可以考虑使用CRTP。 
> ⏱ 2023-05-16 23:10:02 ^43770317-12-2968-3035

#### 2.2 基于包展开与折叠表达式的优化

> 📌 我们在第1章讨论循环逻辑的编写方法时，就介绍过包展开与折叠表达式。这两种技巧不仅能简化循环逻辑的编写，同时也能在一些场景中减少编译器所构造的实例个数，也即降低元函数的复杂度。 
> ⏱ 2023-05-18 09:15:37 ^43770317-17-401-488

# 读书笔记

## 1.4 顺序、分支与循环代码的编写

### 划线评论
> 📌 这里引入了一个伪参数TDummy，用于将原有的完全特化修改为部分特化。这个伪参数有一个默认值void，这样就能直接以Fun_<int>的形式调用这个元函数，无须为伪参数赋值了。  ^10284435-7Ig2ZRn4u
    - 💭 有点不优雅$&*
    - ⏱ 2023-05-16 21:22:12
   
# 本书评论
