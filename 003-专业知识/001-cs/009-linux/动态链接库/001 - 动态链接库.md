# 001 - 动态链接库

## 参考：
+ [linux 中的.so和.a文件 - 心田居士 - 博客园 (cnblogs.com)](https://www.cnblogs.com/liuzhenbo/p/11031052.html)
+  (推荐，简短干练)[GCC生成动态链接库（.so文件）：-shared和-fPIC选项](https://www.cnblogs.com/liuzhenbo/p/11030946.html)
+  (视频，window)[C/C++动态链接库的简单使用-01_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV197411i7PL)

## 动态链接库的创建：

> Position Independent Code （PIC）
   -fPIC 选项作用于编译阶段，在生成目标文件时就得使用该选项，以生成位置无关的代码。
   
从源文件生成动态链接库：
```bash
gcc -fPIC -shared func.c -o libfunc.so
```
从目标文件生成动态链接库：
```bash
gcc -fPIC -c func.c -o func.o
gcc -shared func.o -o libfunc.so
```

## 动态链接库的使用：

```bash
gcc file1.o file2.o -Lpath -lxxx -o program.exe
```

编译器会先在path文件夹下搜索libxxx.so文件，如果没有找到，继续搜索libxxx.a（静态库）。

在程序运行期间，也需要告诉系统去哪里找你的动态链接库文件。在UNIX下是通过定义名为 `LD_LIBRARY_PATH `的环境变量来实现的。只需将path赋值给此变量即可。csh 命令为：

```bash
setenv LD_LIBRARY_PATH your/full/path/to/dll
```
一切安排妥当后，你可以用 ldd 命令检查是否连接正常
```bash
ldd program.exe
```

