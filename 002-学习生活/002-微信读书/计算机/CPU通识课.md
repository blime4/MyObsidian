---
doc_type: weread-highlights-reviews
bookId: "43134597"
author: 靳国杰 张戈
cover: https://wfqqreader-1252317822.image.myqcloud.com/cover/597/43134597/t7_43134597.jpg
reviewCount: 1
noteCount: 25
readingStatus: 读完
progress: 100%
totalReadDay: 10
readingTime: 3小时21分钟
readingDate: 2022-10-13
finishedDate: 2023-07-26
isbn: 9787115576378
lastReadDate: 2023-07-26

---
# 元数据
> [!abstract] CPU通识课
> - ![ CPU通识课|200](https://wfqqreader-1252317822.image.myqcloud.com/cover/597/43134597/t7_43134597.jpg)
> - 书名： CPU通识课
> - 作者： 靳国杰 张戈
> - 简介： 中央处理器（CPU）是计算机中最重要的芯片。CPU的设计和制造水平是一个国家信息技术实力的象征，产业生态的构建需要培养更多掌握CPU技术原理的高端人才。本书基于龙芯CPU团队在20年间积累的技术和经验，从CPU概览篇、CPU术语篇、CPU原理篇、CPU生产制造篇、CPU生态篇、CPU家族篇、中国CPU篇等七大板块剖析CPU，生动有趣地讲解CPU的基础概念、核心原理、生产制造及产业生态，更解读了龙芯CPU的研发历史、核心特色和生态建设经验，让读者循序渐进地进入CPU的殿堂。
> - 出版时间 2022-01-01 00:00:00
> - ISBN： 9787115576378
> - 分类： 计算机-理论知识
> - 出版社： 人民邮电出版社
> - PC地址：https://weread.qq.com/web/reader/3023296072922e853025472

# 高亮划线

### 第1节 CPU时代

> 📌 CPU集成了高性能计算的理论研究成果。随着计算机结构的发展，CPU也不断加入新的学术成果，例如流水线、动态调度、多发射、猜测执行等高级机制。 
> ⏱ 2023-07-26 18:46:14 ^43134597-8-8154-8224

### 第2节 CPU性能论

> 📌 冯·诺依曼体系结构的基本思想：计算机 = 程序 + 存储。 
> ⏱ 2022-10-15 13:09:23 ^43134597-9-2978-3007

> 📌 优秀的编译器能够使用更多的优化算法，生成更高效的二进制指令。例如Intel公司自己开发了编译器icc，效率能比开源的编译器gcc高50%以上。 
> ⏱ 2022-10-22 01:32:07 ^43134597-9-7479-7550

> 📌 使用UnixBench测试出来的分值会有很大的误导性，真正有意义的测试工具还是SPEC CPU和STREAM。 
> ⏱ 2022-10-22 01:34:39 ^43134597-9-9727-9782

### 第1节 计算机的语言：指令集

> 📌 我终于明白“兼容性”是怎么回事了。这是指我们得保留所有原有的错误。——丹尼·塔塞尔（Dennie van Tassel） 
> ⏱ 2022-10-24 13:41:43 ^43134597-12-403-514

### 第2节 繁简之争：精简指令集

> 📌 但是，指令集的增长也带来了很多弊端。第一，CPU的设计制造更复杂，用于解析指令的电路开销变大，也更容易导致设计错误 
> ⏱ 2022-10-24 23:48:37 ^43134597-13-2357-2414

> 📌 第二，指令之间产生了很多的重复功能，很多新增的指令只是把已有多条指令的功能组合起来，相当于引入了很多的冗余，不符合指令集的正交性原则。第三，也是最严重的问题，指令的长度不同，执行时间有长有短，不利于实现流水线式结构[4]，也不利于编译器进行优化调度 
> ⏱ 2022-10-24 23:49:54 ^43134597-13-2415-2684

> 📌 RISC计算机指令条数一般不超过100条，每条指令长度相同，二进制编码遵循统一的规格，非常便于实现流水线式计算机和编译器调度。 
> ⏱ 2022-10-24 23:57:34 ^43134597-13-3392-3455

> 📌 20世纪90年代以后出现的新指令集基本都属于RISC。到现在还在大量使用的主流CISC应该只剩下一种了，即Intel公司的x86指令集 
> ⏱ 2022-10-25 00:02:05 ^43134597-13-3516-3583

### 第3节 第一次抽象：汇编语言

> 📌 高级语言只定义了面向大多数问题的共性语法，但每一种指令集都会有一些特性是高级语言无法实现的，例如读写CPU内部的寄存器、访问外设的端口等。这种情况下必须使用汇编语言。 
> ⏱ 2022-10-26 23:42:12 ^43134597-14-3314-3397

### 第4节 做CPU就是做微结构

> 📌 IP核（Intellectual Property Core）是指一个设计好的电路模块。IP核实现了一个预定义的电路功能，可以在不同的芯片中重复使用。 
> ⏱ 2022-10-26 23:52:08 ^43134597-15-2168-2243

> 📌 典型的SoC中能够包括CPU、内存、外部通信接口模块、电源和功耗管理模块，等等。 
> ⏱ 2022-10-26 23:56:08 ^43134597-15-3717-3757

> 📌 手机中也有很多SoC芯片在使用。例如高通公司的骁龙865芯片（2019年12月发布），专用于智能手机，集成了8个CPU、5G通信模块、3D图形模块、人工智能（AI）模块、Wi-Fi、蓝牙、USB、摄像头、音频、充电管理。这个芯片采用7nm工艺，面积还不到一个1角硬币大小！ 
> ⏱ 2022-10-26 23:57:12 ^43134597-15-3940-4076

> 📌 生产芯片可以通过买IP走捷径，但掌握自己的技术没有捷径 
> ⏱ 2022-10-27 00:04:51 ^43134597-15-4432-4459

> 📌 除了CPU核以外，几乎所有标准的电路模块都可以在市场上买到IP，例如内存控制器（DDR）、图形处理器（GPU）、网络控制器、外设控制器（PCIE）、硬盘控制器（SATA）、USB控制器，等等，甚至连CPU中的一个温度传感器都是可以买到的。 
> ⏱ 2022-10-27 00:05:55 ^43134597-15-5050-5169

### 第5节 解读功耗

> 📌 2000年以后，云计算（Cloud Computing）技术开始出现，海量的服务器被集中到一个数据中心提供计算服务。 
> ⏱ 2022-10-27 15:03:13 ^43134597-16-2245-2303

> 📌 超大型的数据中心往往有几万台到几十万台服务器，占地面积大，这样的数据中心附近都要专门建设发电厂，电费的成本约占整个数据中心成本的1/3。根据2010年的一份报告指出，全世界的数据中心在2010年所消耗的电力，约是全球2010年总发电量的1.1%～1.5%[5]。 
> ⏱ 2022-10-27 15:03:28 ^43134597-16-2303-2579

### 第7节 通用还是专用？

> 📌 CPU永远不可能被GPU取代。CPU是机器的主宰，承担绝大多数通用计算工作。GPU只是把很少种类的计算使用并行方法，从而算得更快 
> ⏱ 2022-10-27 18:44:54 ^43134597-18-400-464

### 第6节 并行计算机的内存

> 📌 目前最常用的方法是基于目录的Cache一致性协议。在互联网络中实现一个全局的目录表，表中的每一项记录一个存储单元的状态，也就是这个存储单元在哪些CPU的Cache中已经有备份。当一个CPU写内存时，要查找目录表，如果该内存单元在其他CPU中含有备份，则向其他CPU发送广播通知。目标CPU收到通知后，更新自身包含的Cache数据。 
> ⏱ 2023-06-14 02:01:32 ^43134597-36-2197-2362

> 📌 严格的一致性会严重丧失性能，“弱一致性”是计算机制造者和程序员的妥协 
> ⏱ 2023-07-26 18:41:07 ^43134597-36-2563-2597

### 第7节 集大成：从CPU到计算机

> 📌 总线（Bus）是模块之间的通信线路，是把所有模块连接起来的纽带，是CPU作为计算机的大脑来指挥其他模块的神经中枢。 
> ⏱ 2023-07-26 19:15:07 ^43134597-37-1144-1201

> 📌 计算机的核心模块要求高速的互联，例如CPU与内存之间的连接，这种总线称为“系统总线”，有的公司称为“前端总线”；而用于连接外围设备的总线则不要求这么高的计算速度，称为“外设总线”。 
> ⏱ 2023-07-26 19:17:44 ^43134597-37-1247-1337

> 📌 有的计算机采用一个独立的芯片来管理外围设备，称为桥片。桥片可以看作CPU的“副官”，把管理外设的工作接管过来。桥片一端接CPU，另一端接各种外设。 
> ⏱ 2023-07-26 19:18:25 ^43134597-37-1361-1434

> 📌 （1）键盘探测到有按键被按下，然后会发出一个电信号给主板上的桥片7A1000。
（2）桥片7A1000接收到来自外围设备的电信号，并把这个事件信息保存在自身的一个寄存器中。桥片7A1000通过系统总线向龙芯CPU的中断引脚发出通知信号。
（3）龙芯CPU收到中断信号，先保存在自身的一个“中断状态寄存器”中。
（4）在CPU的指令流水线中，取指令单元从内存中加载指令的同时，会把中断状态寄存器的内容附在指令后面送入乱序执行的重排序缓存（Reorder Buffer）中。在发射指令时，检查到重排序缓存中有中断状态，则按照例外的处理机制，撤销还没有提交（COMMIT）的指令。
（5）CPU切换特权级，提升为操作系统权限，把当前指令地址强行修改为操作系统中处理中断的软件模块入口，即中断处理程序的入口。
（6）中断处理程序检查桥片7A1000的寄存器，提取出最早触发中断的来源，发现是一个键盘事件。中断处理程序读取寄存器的内容，判断是哪一个按键的编码。
（7）中断处理程序检查是哪个应用程序在等待按键。由于是在WPS软件界面中按下键盘，中断处理程序要把这个按键编码传递给WPS应用程序。具体做法是在操作系统中维护一个针对 WPS应用程序的键盘事件队列，刚刚按下的按键编码被加入这个队列中。键盘事件队列位于操作系统的核心数据区。
（8）中断处理程序执行结束后，返回操作系统。
（9）操作系统切换CPU的特权级，降低到应用程序权限，把WPS应用程序恢复运行。
（10）WPS应用程序变成活跃状态，接收按键事件。WPS无法直接访问键盘事件队列，而是需要使用系统调用（System Call）来获取操作系统的服务，由操作系统读取核心数据区，把键盘事件队列中的按键编码传递给WPS应用程序。
（11）至此，WPS应用程序已经接收到了按键的编码，需要在界面中显示输入的字符。具体过程是WPS调用绘图函数，控制显卡设备进行绘图，显卡会把图像信息传递给显示器，这样就在计算机屏幕上描绘出正确的字符点阵。 
> ⏱ 2023-07-26 19:27:32 ^43134597-37-5741-6813

> 📌 计算机处理一次按键事件的流程 
> ⏱ 2023-07-26 19:24:21 ^43134597-37-7083-7097

# 读书笔记

## 第4节 做CPU就是做微结构

### 划线评论
> 📌 龙芯CPU完全自研，没有采用任何第三方IP核，完全自主设计。  ^10284435-7DiXg5lf2
    - 💭 牛蛙牛蛙
    - ⏱ 2022-10-27 00:06:42
   
# 本书评论
